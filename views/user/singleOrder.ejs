<%-include('../user/partials/user-header.ejs') -%>

    <!-- Checkout -->
  
    <div class="container bg0 p-t-60 p-b-85 mt-5 p">
        <div class="row">
            <div class="col-lg-10 col-xl-7 m-lr-auto ">
                <div class="m-l-25 m-r--38 m-lr-0-xl">
                    <div class="wrap-table-shopping-cart">
                        
                            <table class="table-shopping-cart" id="adrs">
                                <tr class="table_head">
                                    <th class="p-l-15">Address 

                                       
                                          </div>
                                      </th>
                                    <!-- <td class="p-r-20"><button class="btn text-primary" data-toggle="collapse"
                                            data-target="#collapseExample" aria-expanded="false"
                                            aria-controls="collapseExample"> Change</button></td> -->

                                            
                                </tr>
                            
                                
                                <tr class="table_row">

                                
                                     

                                    <td class="p-l-30">
                                        <p><strong>Full Name :</strong>
                                            <%= order.address.name %> 
                                        </p>
                                        <p><strong>Phone Number :</strong>
                                            <%= order.address.phoneNumber %> 
                                        </p>
                                        <p><strong>Address Type :</strong>
                                           jfdj
                                            </p>
                                        <p><strong>Address :</strong>

                                            <%= order.address.address %> <br>
                                            <%= order.address.city %> ,
                                            <%= order.address.state %> ,
                                            <%= order.address.pincode %> 
                                            
                                        
                                        
                                        </p>
                                    </td>
                                </tr>
                                <tr class="table_head">
                                    <th class="p-l-15">products 

                                       
                                          </div>
                                      </th>
                                      </tr>
                                      <% items.forEach((product)=>{ %> 
                                      <tr class="table_row">

                                
                                     

                                        <td class="p-l-30">
                                            <p><strong>product Name :</strong>
                                                <%=product.productName %> 
                                            </p>
                                            <p><strong>Product Price :</strong>
                                                <%=product.productPrice %> 
                                            </p>
                                            <p><strong>Quantity :</strong>
                                               <%= product.quantity  %> 
                                                </p>
                                            <p><strong>Total price :</strong>
                                                <%= product.totalPrice %> 
    
                                            </p>
                                        </td>
                                    </tr>
                                    <% }) %> 
                            </table>
                          
                            <!-- <div class="collapse" id="collapseExample">
                                <form action="/changeAddress" method="post">
                                    <div class="card card-body">
                                       
                                            <div class="form-check card card-body">
                                                <input class="form-check-input" type="radio" value=""
                                                    name="index" id="exampleRadios1">
                                                <label class="form-check-label" for="exampleRadios1">
                                                    <p><strong>Full Name :</strong>
                                                      
                                                    </p>
                                                    <p><strong>Phone Number :</strong>
                                                        
                                                    </p>
                                                    <p><strong>Address :</strong>
                                                        </span>
                                                    </p>
                                                </label>
                                            </div>
                                           
                                                <button type="submit"
                                                    class="flex-c-m stext-101 cl2 size-119 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-10">
                                                    Deliver Here
                                                </button>
                                    </div>
                                </form>
                            </div> -->
                           
                               
                    </div>
                </div>
            </div>


            <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50" id="cancel" >
                <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                    <h4 class="mtext-109 cl2 p-b-30">Your order</h4>
                   

                       

                            <div class="flex-w flex-t p-t-27 p-b-33">
                                <div class="size-208 p-b-5">
                                    <span class="mtext-101 cl2">Cart Total: </span>
                                </div>

                                <div class="size-209 p-t-1 p-b-5 d-flex justify-content-end">
                                    <span class="mtext-110 cl2">
                                        <%= order.totalAmount  %> 
                                    </span>
                                </div>
                                <br>

                                <hr>
                                    <div class="size-208 p-b-5">
                                        <span class="mtext-101 cl2">Grand total</span>
                                    </div>

                                    <div class="size-209 p-t-1 p-b-5 d-flex justify-content-end">
                                        <span class="mtext-110 cl2">
                                            <%= order.totalAmount  %> 
                                        </span>
                                    </div>
                                    <hr>
                                   
<!--                                      
                                        <div class="size-208 p-b-10 m-t-10 bor12">
    
                                        <select name="coupon" id="coupon" style="width: 200px; height: 30px;">
                                         
                                        </select>  
                                        </div> -->

                                        <!-- <div class="size-209 bor12 p-b-10 m-t-10 d-flex justify-content-end">
                                            <button onclick="applyCoupon()" class="p-1 rounded"
                                                style="border: 1px solid; border-color: rgb(159, 159, 159); width: 60px;"></button>
                                        </div> -->

                                        <div class="size-208 mt-2 p-b-5 ">
                                            <span class="mtext-101 cl2">Payment Method  </span>
                                        </div>

                                        <div class="size-209 mt-2 p-t-1 p-b-5 d-flex justify-content-end">
                                            <span class="mtext-110 cl2">₹ 
                                                <% if(order.paymentMethod == 'COD'){ %> 
                                                    Cash On Delivery
                                                <%}else{  %>
                                                    Online Payment 
                                                    <% } %> 
                                                 </span>
                                        </div>
                                        <div class="size-208 mt-2 p-b-5 ">
                                            <span class="mtext-101 cl2">Payment Status  </span>
                                        </div>

                                        <div class="size-209 mt-2 p-t-1 p-b-5 d-flex justify-content-end">
                                            <span class="mtext-110 cl2">₹ 
                                               <%= order.paymentStatus  %> 
                                                 </span>
                                        </div>
                                        <div class="size-208 mt-2 p-b-5 ">
                                            <span class="mtext-101 cl2">Order Status  </span>
                                        </div>

                                        <div class="size-209 mt-2 p-t-1 p-b-5 d-flex justify-content-end">
                                            <span class="mtext-110 cl2">₹ 
                                               <%= order.orderStatus%>
                                                 </span>
                                        </div>
                            </div>
                           <% if(order.orderStatus == "Cancelled"){ %> 
                                <a  href="/products"
                                    class="btn-primary flex-c-m stext-101 cl0 size-116 bor14 p-lr-15 trans-04 pointer">
                                    Back to shop
                                </a>
                                <% }else{ %> 
                                    <button  onclick="orderCancel('<%=order._id%>')"
                                    class="btn-danger flex-c-m stext-101 cl0 size-116 bor14 p-lr-15 trans-04 pointer">
                                    Cancel Order
                                </button>
                                    <% } %> 
                            

                           
                           
                            
                </div>
            </div>
        </div>
    </div>



       <div >

     
</div>
</div>
</div>

       </div>
    
    
        <script>






          async function placeOrder() {
           
            let paymentMethod = document.querySelector("#cod").checked
        ? "COD"
        : "Razorpay";
    
             
                // window.alert(paymentMethod)
                $.ajax({
                    url: '/user_order',
                    method: 'post',
                    data: {
                        payment : paymentMethod
                    },
                    success: (response) => {
                        alert('here')
                        if (response.codSuccess) {
                           
                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: 'Order Success',
                                customClass: 'swal-wide',
                                showConfirmButton: false,
                                timer: 1000
                            })
                                 window.location.replace('/order_success');
                           
                        } else {
                           
                            if (response.order == null) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Connection Failed',
                                    text: 'Please Check the Internet Connection!',
                                    customClass: 'swal-wide',
                                })
                            } else {
                                alert("ethiii")
                               
                                razorpayPayment(response)
                            }
                        }
                    }
                })
    
            }
            function razorpayPayment(Payment) {
                var options = {
                    "key": "rzp_test_filNO2IPOu8MkQ", // Enter the Key ID generated from the Dashboard
                    "amount": Payment.order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                    "currency": "INR",
                    "name": "Home Electron ",
                    "description": "Complete Your Transaction",
                    "image": "",
                    "order_id": Payment.order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                    "handler": function (response) {
                        verifyPayment(response, Payment.order)
                    },
                    "prefill": {
                        "name": Payment.userOrder.Address.firstName + " " + Payment.userOrder.Address.lastName,
                        "email": Payment.User.email,
                        "contact": Payment.userOrder.Address.mobileNo
                    },
                    "notes": {
                        "address": "Home electron Choose your electric Best for Home"
                    },
                    "theme": {
                        "color": "#3399cc"
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
            }
    
           function verifyPayment(payment, order) {
                $.ajax({
                    url: '/verify_payment',
                    data: {
                        payment: payment,
                        orders: order
                    },
                    method: 'post',
                    success: (response) => {
                        if (response.status) {
                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: 'Payment Success',
                                showConfirmButton: false,
                                customClass: 'swal-wide',
                                timer: 1000
                            }).then((result) => {
                                location.href = '/order_success'
                            })
                        } else {
                            Swal.fire({
                                position: 'center',
                                icon: 'error',
                                title: 'Payment Failed',
                                showConfirmButton: false,
                                customClass: 'swal-wide',
                                timer: 1000
                            }).then((result) => {
                                location.reload()
                            })
                        }
                    }
                })
            }
    
    
        </script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

<%-include('../user/partials/user-footer.ejs') -%>