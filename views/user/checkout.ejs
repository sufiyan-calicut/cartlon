<%-include('../user/partials/user-header.ejs') -%>

    <!-- Checkout -->
   <% if(address){ %>
    <div class="container bg0 p-t-60 p-b-85 mt-5 p">
        <div class="row">
            <div class="col-lg-10 col-xl-7 m-lr-auto ">
                <div class="m-l-25 m-r--38 m-lr-0-xl">
                    <div class="wrap-table-shopping-cart">
                        
                            <table class="table-shopping-cart" id="adrs">
                                <tr class="table_head">
                                    <th class="p-l-15">Address 

                                        <div class="btn-group " style="float: right; margin-right: 10px;">
                                            <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                              Change address
                                            </button>
                                            <div class="dropdown-menu dropdown-menu-right">
                                            <% addressType.forEach((ad,index)=>{  %> 
                                              <button class="dropdown-item" type="button" onclick="changeAdress('<%= index++ %>')"> <%= ad.addressType  %>  </button>
                                              <% }) %> 
                                            </div>
                                          </div>
                                      </th>
                                    <!-- <td class="p-r-20"><button class="btn text-primary" data-toggle="collapse"
                                            data-target="#collapseExample" aria-expanded="false"
                                            aria-controls="collapseExample"> Change</button></td> -->

                                            
                                </tr>
                            
                                
                                <tr class="table_row">

                                
                                     

                                    <td class="p-l-30">
                                        <p><strong>Full Name :</strong>
                                            <%= address.fullName  %> 
                                        </p>
                                        <p><strong>Phone Number :</strong>
                                        <%= address.phoneNumber  %> 
                                        </p>
                                        <p><strong>Address Type :</strong>
                                            <%= address.addressType  %> 
                                            </p>
                                        <p><strong>Address :</strong>
                                         <%= address.address  %> <%= address.city  %> <br>
                                         <%= address.state  %> <%= address.pincode  %>  
                                        
                                        </p>
                                    </td>
                                </tr>
                            </table>
                          
                            <!-- <div class="collapse" id="collapseExample">
                                <form action="/changeAddress" method="post">
                                    <div class="card card-body">
                                       
                                            <div class="form-check card card-body">
                                                <input class="form-check-input" type="radio" value=""
                                                    name="index" id="exampleRadios1">
                                                <label class="form-check-label" for="exampleRadios1">
                                                    <p><strong>Full Name :</strong>
                                                      
                                                    </p>
                                                    <p><strong>Phone Number :</strong>
                                                        
                                                    </p>
                                                    <p><strong>Address :</strong>
                                                        </span>
                                                    </p>
                                                </label>
                                            </div>
                                           
                                                <button type="submit"
                                                    class="flex-c-m stext-101 cl2 size-119 bg8 bor13 hov-btn3 p-lr-15 trans-04 pointer m-tb-10">
                                                    Deliver Here
                                                </button>
                                    </div>
                                </form>
                            </div> -->
                           
                                <div class="card card-body">
                                    <button type="button" data-toggle="collapse" data-target="#newAddress"
                                        aria-expanded="false" aria-controls="newAddress">
                                        Add new address
                                    </button>
                                    <div class="collapse" id="newAddress">
                                        <div class="card card-body">

                                            <form action="/newAddress" method="POST" class="row mt-4">

                                              

                                                <div class="col-md-6 mb-3">
                                                    <label for="validationDefault01" class="form-label">Full
                                                        name</label>
                                                    <input type="text" name="fullName" class="form-control"
                                                        id="validationDefault01" required>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="validationDefault02" class="form-label">Phone
                                                        number</label>
                                                    <input type="number" name="phoneNumber" class="form-control"
                                                        id="validationDefault02" required>
                                                </div>
                                                <div class="col-md-8 mb-3">
                                                    <label for="validationDefault02" class="form-label">Address</label>
                                                    <input type="text" name="address" class="form-control"
                                                        id="validationDefault02" required>
                                                </div>
                                                <div class="col-md-6 mb-3">
                                                    <label for="validationDefault01" class="form-label">
                                                        adrress type</label>
                                                    <input type="text" name="addressType" class="form-control"
                                                        id="validationDefault01" value="ex:office calicut" required>
                                                </div>
                                                <!-- <div class="col-md-4 mb-3">
                                                    <label for="validationDefault02" class="form-label">Type</label>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="type"
                                                            id="inlineRadio1" value="Home">
                                                        <label class="form-check-label" for="inlineRadio1">Home</label>
                                                    </div>
                                                    <div class="form-check form-check-inline p-l-15">
                                                        <input class="form-check-input" type="radio" name="type"
                                                            id="inlineRadio2" value="Office">
                                                        <label class="form-check-label"
                                                            for="inlineRadio2">Office</label>
                                                    </div>
                                                </div> -->
                                                <div class="col-md-4 mb-3">
                                                    <label for="validationDefault04" class="form-label">City</label>
                                                    <input type="text" name="city" class="form-control"
                                                        id="validationDefault03" required>
                                                </div>
                                                <div class="col-md-4 mb-3 ">
                                                    <label for="validationDefault03" class="form-label">State</label>
                                                    <select name="state" id="state" class="form-control" required>
                                                        <option value="">Select one</option>
                                                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                                                        <option value="Andaman and Nicobar Islands">Andaman and Nicobar
                                                            Islands
                                                        </option>
                                                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                                        <option value="Assam">Assam</option>
                                                        <option value="Bihar">Bihar</option>
                                                        <option value="Chandigarh">Chandigarh</option>
                                                        <option value="Chhattisgarh">Chhattisgarh</option>
                                                        <option value="Delhi">Delhi</option>
                                                        <option value="Lakshadweep">Lakshadweep</option>
                                                        <option value="Puducherry">Puducherry</option>
                                                        <option value="Goa">Goa</option>
                                                        <option value="Gujarat">Gujarat</option>
                                                        <option value="Haryana">Haryana</option>
                                                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                                                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                                        <option value="Jharkhand">Jharkhand</option>
                                                        <option value="Karnataka">Karnataka</option>
                                                        <option value="Kerala">Kerala</option>
                                                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                                                        <option value="Maharashtra">Maharashtra</option>
                                                        <option value="Manipur">Manipur</option>
                                                        <option value="Meghalaya">Meghalaya</option>
                                                        <option value="Mizoram">Mizoram</option>
                                                        <option value="Nagaland">Nagaland</option>
                                                        <option value="Odisha">Odisha</option>
                                                        <option value="Punjab">Punjab</option>
                                                        <option value="Rajasthan">Rajasthan</option>
                                                        <option value="Sikkim">Sikkim</option>
                                                        <option value="Tamil Nadu">Tamil Nadu</option>
                                                        <option value="Telangana">Telangana</option>
                                                        <option value="Tripura">Tripura</option>
                                                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                                                        <option value="Uttarakhand">Uttarakhand</option>
                                                        <option value="West Bengal">West Bengal</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-4 mb-3">
                                                    <label for="validationDefaultUsername"
                                                        class="form-label">Pincode</label>
                                                    <div class="input-group">
                                                        <input type="number" name="pincode" class="form-control"
                                                            id="validationDefaultUsername" minlength="6" required>
                                                    </div>
                                                </div>

                                                <div class="col-12 ">
                                                    <button class="btn btn-primary" type="submit">Submit</button>
                                                </div>
                                            </form>

                                        </div>
                                    </div>
                                </div>
                    </div>
                </div>
            </div>


            <div class="col-sm-10 col-lg-7 col-xl-5 m-lr-auto m-b-50" id="order">
                <div class="bor10 p-lr-40 p-t-30 p-b-40 m-l-63 m-r-40 m-lr-0-xl p-lr-15-sm">
                    <h4 class="mtext-109 cl2 p-b-30">Your order</h4>
                   

                       

                            <div class="flex-w flex-t p-t-27 p-b-33">
                                <div class="size-208 p-b-5">
                                    <span class="mtext-101 cl2">Cart Total: </span>
                                </div>

                                <div class="size-209 p-t-1 p-b-5 d-flex justify-content-end">
                                    <span class="mtext-110 cl2">
                                        ₹ <%= cart.total %>
                                    </span>
                                </div>
                                    <div class="size-208 p-b-5">
                                        <span class="mtext-101 cl2"></span>
                                    </div>

                                    <div class="size-209 p-t-1 p-b-5 d-flex justify-content-end">
                                        <span class="mtext-110 cl2">
                                            
                                        </span>
                                    </div>
                                   
<!--                                      
                                        <div class="size-208 p-b-10 m-t-10 bor12">
    
                                        <select name="coupon" id="coupon" style="width: 200px; height: 30px;">
                                         
                                        </select>  
                                        </div> -->

                                        <!-- <div class="size-209 bor12 p-b-10 m-t-10 d-flex justify-content-end">
                                            <button onclick="applyCoupon()" class="p-1 rounded"
                                                style="border: 1px solid; border-color: rgb(159, 159, 159); width: 60px;"></button>
                                        </div> -->

                                        <div class="size-208 mt-2 p-b-5 ">
                                            <span class="mtext-101 cl2">Total:  </span>
                                        </div>

                                        <div class="size-209 mt-2 p-t-1 p-b-5 d-flex justify-content-end">
                                            <span class="mtext-110 cl2">₹ 
                                                <% if(cart.subtotal == 0) {%> 
                                                    <%=cart.total%> 
                                                    <% }else {%> 
                                                        <%= cart.subtotal  %>
                                                        <% } %>  
                                                 </span>
                                        </div>
                            </div>
                            <form   id="place-order" novalidate="novalidate">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="paynow"
                                        value="Razorpay" >
                                    <label class="form-check-label" for="paynow">
                                        Razorpay
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod" checked>
                                    <label class="form-check-label" for="cod" >
                                        Cash on delivery
                                    </label>
                                </div>
                                <button  type="submit" 
                                    class="btn-success flex-c-m stext-101 cl0 size-116 bor14 p-lr-15 trans-04 pointer">
                                    Place Order
                                </button>
                            </form>

                           
                           
                            
                </div>
            </div>
        </div>
    </div>
    <% }else{ %>


       <div >

        <div class="card card-body" >
            <button type="button" data-toggle="collaps" data-target="#newAddress"
                aria-expanded="false" aria-controls="newAddress" >
                <h3 style="margin: 20px;">  Add your Address </h3>
              
            </button>
            <div class="collaps" id="newAddress">
                <div class="card card-body" style="margin: auto; display: block; max-width: 800px; width: 100%;">

                    <form action="/newAddress" method="POST" class="row mt-4">

                      

                        <div class="col-md-6 mb-3">
                            <label for="validationDefault01" class="form-label">Full
                                name</label>
                            <input type="text" name="fullName" class="form-control"
                                id="validationDefault01" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="validationDefault02" class="form-label">Phone
                                number</label>
                            <input type="number" name="phoneNumber" class="form-control"
                                id="validationDefault02" required>
                        </div>
                        <div class="col-md-8 mb-3">
                            <label for="validationDefault02" class="form-label">Address</label>
                            <input type="text" name="address" class="form-control"
                                id="validationDefault02" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="validationDefault01" class="form-label">
                                adrress type</label>
                            <input type="text" name="addressType" class="form-control"
                                id="validationDefault01" value="ex:office calicut" required>
                        </div>
                        <!-- <div class="col-md-4 mb-3">
                            <label for="validationDefault02" class="form-label">Type</label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="type"
                                    id="inlineRadio1" value="Home">
                                <label class="form-check-label" for="inlineRadio1">Home</label>
                            </div>
                            <div class="form-check form-check-inline p-l-15">
                                <input class="form-check-input" type="radio" name="type"
                                    id="inlineRadio2" value="Office">
                                <label class="form-check-label"
                                    for="inlineRadio2">Office</label>
                            </div>
                        </div> -->
                        <div class="col-md-4 mb-3">
                            <label for="validationDefault04" class="form-label">City</label>
                            <input type="text" name="city" class="form-control"
                                id="validationDefault03" required>
                        </div>
                        <div class="col-md-4 mb-3 ">
                            <label for="validationDefault03" class="form-label">State</label>
                            <select name="state" id="state" class="form-control" required>
                                <option value="">Select one</option>
                                <option value="Andhra Pradesh">Andhra Pradesh</option>
                                <option value="Andaman and Nicobar Islands">Andaman and Nicobar
                                    Islands
                                </option>
                                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                <option value="Assam">Assam</option>
                                <option value="Bihar">Bihar</option>
                                <option value="Chandigarh">Chandigarh</option>
                                <option value="Chhattisgarh">Chhattisgarh</option>
                                <option value="Delhi">Delhi</option>
                                <option value="Lakshadweep">Lakshadweep</option>
                                <option value="Puducherry">Puducherry</option>
                                <option value="Goa">Goa</option>
                                <option value="Gujarat">Gujarat</option>
                                <option value="Haryana">Haryana</option>
                                <option value="Himachal Pradesh">Himachal Pradesh</option>
                                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                <option value="Jharkhand">Jharkhand</option>
                                <option value="Karnataka">Karnataka</option>
                                <option value="Kerala">Kerala</option>
                                <option value="Madhya Pradesh">Madhya Pradesh</option>
                                <option value="Maharashtra">Maharashtra</option>
                                <option value="Manipur">Manipur</option>
                                <option value="Meghalaya">Meghalaya</option>
                                <option value="Mizoram">Mizoram</option>
                                <option value="Nagaland">Nagaland</option>
                                <option value="Odisha">Odisha</option>
                                <option value="Punjab">Punjab</option>
                                <option value="Rajasthan">Rajasthan</option>
                                <option value="Sikkim">Sikkim</option>
                                <option value="Tamil Nadu">Tamil Nadu</option>
                                <option value="Telangana">Telangana</option>
                                <option value="Tripura">Tripura</option>
                                <option value="Uttar Pradesh">Uttar Pradesh</option>
                                <option value="Uttarakhand">Uttarakhand</option>
                                <option value="West Bengal">West Bengal</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="validationDefaultUsername"
                                class="form-label">Pincode</label>
                            <div class="input-group">
                                <input type="number" name="pincode" class="form-control"
                                    id="validationDefaultUsername" minlength="6" required>
                            </div>
                        </div>

                        <div class="col-12 ">
                            <button class="btn btn-primary" type="submit">Submit</button>
                        </div>
                    </form>

                </div>
            </div>
        </div>
</div>
</div>
</div>

       </div>
        <% } %> 

    
        <script>
            






        //   async function placeOrder() {
           
        
    
             
        //         // window.alert(paymentMethod)
        //         $.ajax({
        //             url: '/user_order',
        //             method: 'post',
        //             data: {
        //                 payment : paymentMethod
        //             },
        $("#place-order").submit((e) => {
            //     let paymentMethod = document.querySelector("#cod").checked
        // ? "COD"
        // : "Razorpay";
            e.preventDefault()
            $.ajax({
                url: '/user_order',
                method: 'post',
                data: $('#place-order').serialize(),
                    success: (response) => {
                        // alert('here')
                        if (response.codSuccess) {
                           
                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: 'Order Success',
                                customClass: 'swal-wide',
                                showConfirmButton: false,
                                timer: 1000
                            })
                                 window.location.replace('/order_success');
                           
                        } else {
                           
                            if (response.order == null) {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Connection Failed',
                                    text: 'Please Check the Internet Connection!',
                                    customClass: 'swal-wide',
                                })
                            } else {
                               
                               
                                razorpayPayment(response)
                            }
                        }
                    }
                })
    
            })
        
            function razorpayPayment(Payment) {
                console.log(Payment)
                
                
                var options = {
                    "key": "rzp_test_JNLKfIjgS0l3it", // Enter the Key ID generated from the Dashboard
                    "amount": Payment.order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                    "currency": "INR",
                    "name": "Cartlon Swiss Watches ",
                    "description": "Complete Your Transaction",
                    "image": "",
                    "order_id": Payment.order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                    "handler": function (response) {
                        verifyPayment(response, Payment.order)
                    },
                    "prefill": {
                        "name": Payment.user.name ,
                        "email": Payment.user.email,
                        "contact": Payment.user.phone
                    },
                    "notes": {
                        "address": "Wear Swiss, Feel Proud!"
                    },
                    "theme": {
                        "color": "#3399cc"
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
            }
    
           function verifyPayment(payment, order) {
            // alert("here")
                $.ajax({
                    url: '/verify_payment',
                    data: {
                        payment: payment,
                        orders: order
                    },
                    method: 'post',
                    success: (response) => {
                        if (response.status) {
                            Swal.fire({
                                position: 'center',
                                icon: 'success',
                                title: 'Payment Success',
                                showConfirmButton: false,
                                customClass: 'swal-wide',
                                timer: 1000
                            }).then((result) => {
                                location.href = '/order_success'
                            })
                        } else {
                            Swal.fire({
                                position: 'center',
                                icon: 'error',
                                title: 'Payment Failed',
                                showConfirmButton: false,
                                customClass: 'swal-wide',
                                timer: 1000
                            }).then((result) => {
                                location.reload()
                            })
                        }
                    }
                })
            }
    
    
        </script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

<%-include('../user/partials/user-footer.ejs') -%>